# Android 应用程序开发及背后的设计思想

> 随想

## 第 2 章

Intent 只是一种描述要完成什么工作的跨进程的结构体
IntentFilter 决定如何解析这些 Intent 并完成其响应


## 第 3 章

### 1. 支持应用程序的 Android 系统

- 从系统结构出发，分层式的架构实现 （高级软件设计师）
- 从系统的运行态角度出发，Android 的整个启动过程 （BSP 嵌入式工程师）
- 从源代码的结构出发，通过源码分析具体实现 （学习者或爱好者）

- - -

- 桌面操作系统、服务器操作系统，在设计上的本质都是要尽可能提供一种**多人共享**的系统
- 智能手机操作系统，包含了个人隐私信息，所以对**安全性**的要求是一个很大的挑战。（特别像 Android 这样，设计思路本就是用户会随时随地地下载更多应用程序到系统里，相当于是添加了更多功能到系统里，这时就必须解决安全性问题。）

因为**安全性角度**引入的一些特殊设计上的难题：
1. 既要保持足够的性能，同时又要控制功耗
2. 既要功能丰富，同时又需要灵活的权限控制
3. 既要尽可能实现简单，同时又系统提供灵活性

### 2. Android 应用程序运行环境所带来的需求

- **安全性：** 作为一个功能可灵活拓展的系统，都将面临安全性的挑战
- **跨进程交互：** 因为有了 Intent 和 Activity，我们的系统可能随时随地都在交互，而且会是跨进程的交互，所以需要了解 Android 里独特的进程间通信的方式
- **性能：**
- **功耗控制：**
- **功能：**
- **可移植性：**

#### 2.1 安全性设计

==四大需求：==

1. 应用程序绝对不能对 Android 系统造成破坏
2. 应用程序之间最好不能互相干扰，不可以破坏对方的数据
3. 应用程序 <--> 系统，应用程序 <--> 应用程序，之间应该提供共享的能力
4. 权限控制。给不同应用程序提供系统层功能、提供共享时，需要有权限才能执行，没有权限则会拒绝应用程序的访问

==单内核操作系统的安全模型科普：==

- **单任务系统：** 一个任务运行完才能继续运行下一个 。 ==缺点：性能不高，做耗时操作时必须等待。==
->
- **多任务系统：** 通过固定的中断源（比如时钟中断）打断 CPU 操作，强制让 CPU 进入一段中断处理代码，在这个中断处理代码中，我们可以加入一些代码跳转执行的逻辑，这样就允许代码可以有多种执行序列。这样的**代码序列**被抽象成**任务 Task**，而这种**修改过的中断处理代码**则被称为**调度器**。  ==缺点：任务间的内存是共享的，应用程序之间可能会互相破坏，与想达到的安全性机制不符。==
->
- **安全的多任务、多用户系统：** 每个任务有独立的代码执行序列，同时给它们虚拟的独立内存空间。这可以保证任务间的内存不共享。但是总会有一些共享的需求存在，这时，就再设立一种特权模式，在这种模式里则使用同一份内存，来完成这些共享的需求。即 **用户空间 + 内核空间**
特权模式里的代码经过精心设计，确保执行时不出错，这时就完善了我们前面提到的**安全性模型。**
而 uid + gid 的权限控制，使我们得到了多用户支持。

- - -

==Android 针对四大需求，追求简洁的解决方案，所以参考了 **单内核操作系统的安全模型**==

1. 让所有的应用程序都以非 root 的 uid 权限运行（这样应用程序就不会有权限去破坏系统级功能），又拥有各自的进程空间（这样应用程序之间就可以互不干扰），还可以通过系统调用来进行共享（提供了共享的能力）。
2. uid / gid 设计的初衷是让多个用户共享一台 PC机器上的服务的，但是我们的 Android 设备肯定是不希望多人共享的。


> Java 虚拟机环境实际上是一种通过程序模拟出来的机器执行环境
> JIT(Just In Time) 优化，运行态的优化技术
> 另一套 Java 虚拟机环境，Dalvik 虚拟机

#### 2.2 跨进程通信

#### 2.3 性能

Java 编译生成的结果，是 `.class` 的伪代码，是需要由虚拟机来解析执行的。

dx工具是一种用来转换Java class成为DEX格式的工具。多个类被包含在一个dex文件之中。各个类中重复的字符串和其他常量只在DEX中存放一次，以节省空间。Java字节码（bytecode）被转换成Dalvik虚拟机所使用的替代指令集。一个未压缩dex文件通常稍小于一个已经压缩的.jar档。

**栈式虚拟机**：Java 执行环境在边解释边执行的时候，尽可能使用栈来保存操作数与结果，这样可设计更精炼的虚拟指令的翻译器，性能很高，但问题就在于需要过多的访问内存，因为栈即内存。

**基于寄存器式访问的 Dalvik 虚拟机**：Dalvik 由 Dan Bornstein 编写，名字来源于他的祖先曾经居住过的小渔村**达尔维克**，位于**冰岛埃亚峡湾**。使用 JIT 技术（JIT 即时编译技术，运行时优化，可以在运行过程中把已经计算出来的结果保存下来，下次直接返回，不用再次进行运算）

**ART 虚拟机**：Ahead-of-time（AOT）技术













